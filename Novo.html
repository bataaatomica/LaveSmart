<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LaveSmart - Acesso</title> 
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb; 
        }

        /* Estilos de Navega√ß√£o */
        .nav-item {
            transition: all 0.2s;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #4b5563;
        }
        .nav-item.active {
            background-color: #4f46e5;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .nav-item:not(.active):hover {
            background-color: #f3f4f6;
            color: #1f2937;
        }
        
        /* Oculta os conte√∫dos das abas por padr√£o */
        .tab-content-panel {
            display: none;
            padding-top: 1rem;
        }

        /* Exibe o conte√∫do da aba "Cadastrar Lacre" por padr√£o DENTRO do AppView */
        #content-register[aria-hidden="false"] {
            display: block;
        }

        /* Estilos de badges e cores */
        .badge-green { background-color: #d1fae5; color: #065f46; } 
        .badge-yellow { background-color: #fef9c3; color: #854d0e; } 
        .badge-gray { background-color: #e5e7eb; color: #4b5563; } 
        .badge-indigo { background-color: #e0e7ff; color: #4338ca; }

        /* üö® REFOR√áADO: ESTILOS PARA IMPRESS√ÉO (RECIBO LIMPO) üö® */
        @media print {
            body {
                background-color: white !important;
                margin: 0;
                padding: 0;
            }
            
            /* Oculta elementos irrelevantes para o recibo */
            #authView, 
            #appView > header, 
            #appView > nav, 
            #status-messages, 
            #content-register, /* Garante que a tela de cadastro n√£o apare√ßa */
            #search-area, /* NOVO: Oculta a √°rea de busca completa */
            #update-form-area, /* NOVO: Oculta o formul√°rio de atualiza√ß√£o */
            #print-receipt-btn,
            hr.border-gray-100 { /* Oculta o separador entre form e detalhes */
                display: none !important;
            }

            /* Exibe apenas a √°rea de detalhes (o recibo) */
            #appView {
                display: block !important;
                max-width: none !important;
            }
            #tab-content, #content-history, #seal-details-area {
                display: block !important;
                padding: 0 !important;
                margin: 0 !important;
            }

            /* Estiliza o conte√∫do do recibo */
            .receipt-header {
                display: block !important; /* Mostra o header espec√≠fico do recibo */
                text-align: center;
                margin-bottom: 1rem;
                padding: 1rem;
                border-bottom: 2px dashed #4f46e5;
            }
            .receipt-header h1 {
                font-size: 1.5rem;
                font-weight: bold;
                color: #4f46e5;
            }

            /* Ajusta o painel de detalhes para parecer um recibo */
            .receipt-content {
                box-shadow: none !important;
                border: none !important;
                padding: 1rem !important;
            }
            .receipt-content .grid {
                display: block;
                margin-top: 0.5rem;
            }
            .receipt-content .md\:col-span-1 {
                display: none; /* Oculta o quadrado colorido de status na impress√£o */
            }
            .receipt-content .md\:col-span-2 {
                padding: 0;
            }
            .receipt-content .text-sm {
                font-size: 0.8rem;
            }
            .receipt-content .text-xl {
                font-size: 1.25rem;
            }
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div id="authView" class="flex items-center justify-center min-h-screen p-4">
        
        <div id="loginView" class="w-full max-w-md bg-white shadow-2xl rounded-xl p-8 sm:p-10 transform transition duration-500 hover:scale-[1.02]">
            <h1 class="text-3xl font-extrabold text-center text-indigo-600 mb-6">
                Entrar na Sua Conta
            </h1>
            <p class="text-center text-gray-500 mb-8">
                Digite seu email e senha para acessar sua conta.
            </p>
            
            <form id="loginForm" onsubmit="event.preventDefault(); showApp('Login');">
                
                <div class="mb-5">
                    <label for="login-email" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="login-email" name="email" placeholder="email@exemplo.com" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 shadow-sm"
                        aria-label="Email de Login">
                </div>

                <div class="mb-6">
                    <label for="login-password" class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <input type="password" id="login-password" name="password" placeholder="Sua senha" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 shadow-sm"
                        aria-label="Senha de Login">
                </div>
                
                <button type="submit"
                        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 rounded-lg shadow-md transition duration-200 transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50">
                    Entrar
                </button>
                
                <div class="mt-6 text-center text-sm">
                    <p class="text-gray-500">
                        N√£o tem uma conta? 
                        <a href="#" onclick="toggleAuthView('register'); return false;" class="text-indigo-600 font-medium hover:text-indigo-800 transition duration-150">Cadastrar-se</a>
                    </p>
                </div>
            </form>

        </div>
        
        <div id="registerView" class="hidden absolute w-full max-w-md bg-white shadow-2xl rounded-xl p-8 sm:p-10 transform transition duration-500 hover:scale-[1.02]">
            <h1 class="text-3xl font-extrabold text-center text-indigo-600 mb-6">
                Criar Sua Conta
            </h1>
            <p class="text-center text-gray-500 mb-8">
                Preencha os campos abaixo para come√ßar sua jornada.
            </p>
            
            <form id="registrationForm" onsubmit="event.preventDefault(); showApp('Cadastro');">
                
                <div class="mb-5">
                    <label for="reg-name" class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
                    <input type="text" id="reg-name" name="name" placeholder="Seu nome" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 shadow-sm"
                        aria-label="Nome Completo">
                </div>

                <div class="mb-5">
                    <label for="reg-email" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="reg-email" name="email" placeholder="email@exemplo.com" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 shadow-sm"
                        aria-label="Email de Cadastro">
                </div>

                <div class="mb-6">
                    <label for="reg-password" class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <input type="password" id="reg-password" name="password" placeholder="M√≠nimo 8 caracteres" required minlength="8"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 shadow-sm"
                        aria-label="Senha de Cadastro">
                </div>
                
                <button type="submit"
                        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 rounded-lg shadow-md transition duration-200 transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50">
                    Cadastrar
                </button>
                
                <div class="mt-6 text-center text-sm">
                    <p class="text-gray-500">
                        J√° tem uma conta? 
                        <a href="#" onclick="toggleAuthView('login'); return false;" class="text-indigo-600 font-medium hover:text-indigo-800 transition duration-150">Entrar</a>
                    </p>
                </div>
            </form>

        </div>
    </div> <div id="messageBox" class="fixed top-0 left-0 right-0 p-4 text-center bg-green-500 text-white font-semibold hidden transition-opacity duration-300 ease-in-out shadow-lg z-50">
        </div>


    <div id="appView" class="hidden max-w-4xl mx-auto">
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-extrabold text-indigo-600 mb-2">
                LaveSmart
            </h1>
            <p class="text-gray-600">Interface de registro e rastreamento de pe√ßas.</p>
            <button onclick="goBackToAuth()" class="text-sm text-gray-500 hover:text-indigo-600 mt-2 flex items-center justify-center mx-auto">
                <i data-lucide="log-out" class="w-4 h-4 mr-1"></i> Sair (Voltar ao Login)
            </button>
        </header>
        
        <div id="status-messages"></div>

        <nav class="mb-8 border-b border-gray-200">
            <div class="flex flex-wrap gap-2 sm:gap-4 -mb-px">
                <button id="tab-register" class="nav-item active" aria-controls="content-register">
                    <i data-lucide="save" class="w-5 h-5 mr-1"></i> Cadastrar Lacre
                </button>
                <button id="tab-history" class="nav-item" aria-controls="content-history">
                    <i data-lucide="search" class="w-5 h-5 mr-1"></i> Buscar N√∫mero do Lacre
                </button>
            </div>
        </nav>

        <main id="tab-content" class="max-w-4xl mx-auto">
            
            <div id="content-register" class="tab-content-panel" aria-hidden="false">
                <div class="space-y-6">
                    <h2 class="text-2xl font-semibold text-gray-800 flex items-center">
                        <i data-lucide="save" class="w-6 h-6 mr-2 text-indigo-500"></i> Cadastrar Nova Pe√ßa/Lacre
                    </h2>
                    <form class="p-6 bg-white rounded-xl shadow-lg border border-gray-100 space-y-4" id="register-seal-form">
                        <p class="text-sm text-gray-500 border-b pb-3">
                            Preencha os dados da pe√ßa para gerar o rastreamento.
                        </p>
                        
                        <div class="space-y-1">
                            <label for="register-seal-input" class="block text-sm font-medium text-gray-700">1. N√∫mero do Novo Lacre <span class="text-red-500">*</span></label>
                            <input 
                                id="register-seal-input" 
                                type="text" 
                                placeholder="Ex: 99887 (N√∫mero √∫nico de identifica√ß√£o)" 
                                required 
                                class="w-full border border-gray-300 rounded-xl p-3 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150"
                            />
                        </div>
                        <div class="space-y-1">
                            <label for="register-desc-input" class="block text-sm font-medium text-gray-700 pt-2">2. Descri√ß√£o da Pe√ßa <span class="text-red-500">*</span></label>
                            <input 
                                id="register-desc-input" 
                                type="text" 
                                placeholder="Ex: Terno cinza, novo, sem manchas" 
                                required 
                                class="w-full border border-gray-300 rounded-xl p-3 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150"
                            />
                        </div>
                        
                        <button
                            type="submit"
                            id="register-seal-btn"
                            class="mt-4 w-full flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-xl shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out"
                        >
                            <i data-lucide="save" class="w-5 h-5 mr-2"></i> Confirmar Cadastro do Lacre
                        </button>
                        <p class="text-xs text-gray-400 text-center pt-2">
                            *O lacre ser√° salvo apenas nesta sess√£o (cache).
                        </p>
                    </form>
                </div>
            </div>

            <div id="content-history" class="tab-content-panel" aria-hidden="true">
                <div class="space-y-6">
                    <h2 class="text-2xl font-semibold text-gray-800 flex items-center">
                        <i data-lucide="search" class="w-6 h-6 mr-2 text-indigo-500"></i> Buscar Pe√ßa por N√∫mero do Lacre
                    </h2>
                    
                    <div id="search-area" class="p-6 bg-white rounded-xl shadow-lg border border-gray-100">
                        <label for="seal-input" class="block text-sm font-medium text-gray-700 mb-2">
                            Digite o N√∫mero do Lacre para ver o Hist√≥rico e Atualizar Status/Lavagem
                        </label>
                        <div class="flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4">
                            <input
                                id="seal-input"
                                type="text"
                                placeholder="Tente 11111, 22222, 33333, 44444 ou um lacre que voc√™ cadastrou"
                                value=""
                                class="w-full border border-gray-300 rounded-xl p-3 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150"
                            />
                            <button
                                id="search-seal-btn"
                                class="w-full md:w-auto flex items-center justify-center px-6 py-3 border border-transparent text-sm font-medium rounded-xl shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out"
                            >
                                <i data-lucide="search" class="w-5 h-5 mr-2"></i> Buscar Lacre
                            </button>
                        </div>
                    </div>
                    <div id="seal-details-area" class="mt-6">
                        <div class="text-center py-6 text-gray-500 font-medium">
                            <i data-lucide="info" class="w-5 h-5 mr-1 inline-block"></i>
                            Digite um n√∫mero para simular a busca. Tente 33333 para ver um lacre pronto.
                        </div>
                    </div>
                </div>
            </div>
            
        </main>
    </div> <script>
        // =================================================================
        // L√ìGICA DE NAVEGA√á√ÉO ENTRE TELAS PRINCIPAIS (Login/Cadastro)
        // =================================================================
        
        function toggleAuthView(view) {
            const loginView = document.getElementById('loginView');
            const registerView = document.getElementById('registerView');
            const title = document.querySelector('title');

            if (view === 'register') {
                loginView.classList.add('hidden');
                registerView.classList.remove('hidden', 'absolute'); 
                title.textContent = 'Painel de Cadastro';
            } else { 
                registerView.classList.add('hidden', 'absolute');
                loginView.classList.remove('hidden');
                title.textContent = 'Painel de Login';
            }
            const messageBox = document.getElementById('messageBox');
            messageBox.classList.add('hidden', 'opacity-0');
            messageBox.classList.remove('opacity-100');
        }

        function showApp(actionType) {
            const authView = document.getElementById('authView');
            const appView = document.getElementById('appView');
            const title = document.querySelector('title');

            authView.classList.add('hidden');
            appView.classList.remove('hidden');
            title.textContent = 'LaveSmart';
            
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            showMessage(`${actionType} simulado com sucesso! Acesso liberado.`, 'success');
        }

        function goBackToAuth() {
            const authView = document.getElementById('authView');
            const appView = document.getElementById('appView');
            const title = document.querySelector('title');

            appView.classList.add('hidden');
            authView.classList.remove('hidden');
            toggleAuthView('login'); 
            title.textContent = 'Painel de Login';
            showMessage('Sess√£o encerrada com sucesso.', 'info');
        }
        
        function showMessage(message, type = 'success') {
            const messageBox = document.getElementById('messageBox');
            const bgColor = type === 'info' ? 'bg-indigo-500' : type === 'error' ? 'bg-red-500' : 'bg-green-500';

            messageBox.textContent = message;
            messageBox.className = `fixed top-0 left-0 right-0 p-4 text-center text-white font-semibold transition-opacity duration-300 ease-in-out shadow-lg z-50 ${bgColor}`;
            
            messageBox.classList.remove('hidden', 'opacity-0');
            messageBox.classList.add('opacity-100');

            setTimeout(() => {
                messageBox.classList.remove('opacity-100');
                messageBox.classList.add('opacity-0');
                
                setTimeout(() => {
                    messageBox.classList.add('hidden');
                }, 300); 
            }, 3000);
        }
        
        const STATUS_MAP = {
            'Pendente': { class: 'badge-gray', text: 'Pendente' },
            'Lavando': { class: 'badge-yellow', text: 'Lavando' },
            'Pronto': { class: 'badge-green', text: 'Pronto para retirada' },
            'Entregue': { class: 'badge-indigo', text: 'Entregue' }
        };

        const sealDataCache = {};
        
        function StatusMessage(message, type = 'info') {
            const statusDiv = document.getElementById('status-messages');
            const color = type === 'success' ? 'bg-green-100 border-green-400 text-green-700' : 
                          type === 'error' ? 'bg-red-100 border-red-400 text-red-700' :
                          'bg-indigo-100 border-indigo-400 text-indigo-700';
            
            statusDiv.innerHTML = `
                <div class="p-4 mb-4 border-l-4 ${color} rounded-lg" role="alert">
                    <p class="font-bold">${type.toUpperCase()}</p>
                    <p class="text-sm">${message}</p>
                </div>
            `;
            
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 4000);
        }

        // =================================================================
        // DROPDOWNS E CADASTRO 
        // =================================================================
        const WASH_TYPES = [
            "Selecione o Tipo...", 
            "STONAGEM", "SKY MEDIO", "SKY CLARO", "ALVEJAMENTO", "AMACIADO", 
            "AMARRACOES", "MARMORIZADO", "ALVEJAMENTO BRANCO", "INTER NT", "SKY OXY", 
            "SKY PERMA", "CLAREAMENTO CLORO", "CLAREAMENTO PERMAGANATO", "SOBRETINGO", 
            "USED", "CORTE BARRA", "LASER", "NAVALHADO", "CORROSAO", "RESINA", 
            "RESPINGO", "FOIL", "GLITTER", "SCRUSH", "VIVO", "PUIDO/REBOLO", 
            "ZNAOUTILIZAR", "PINOS", "TINGIMENTO", "PILOTO", "BIGODE CURTO", 
            "BIGODE LONGO", "BIGODE FRENTE/COSTA", "BIGODE COM ESCRITA", "BIGODE C DEVORE", 
            "ESTAMPA LASER", "ESCRITA LASER", "DEVORE LASER", "BIOPOLIMENTO", 
            "DESENHO LASER", "SKY PASTA", "MOSTRUARIO", "LIXADO", "PRENSADO", 
            "CATIONIZADO"
        ];
        
        const getWashTypeSelectors = (currentWashTypes) => {
            let html = '';
            currentWashTypes = Array.isArray(currentWashTypes) ? currentWashTypes : [currentWashTypes || WASH_TYPES[0]];
            
            const numSelectors = 10; 

            for (let i = 0; i < numSelectors; i++) {
                const selectedType = currentWashTypes[i] || WASH_TYPES[0]; 

                let options = '';
                WASH_TYPES.forEach(type => {
                    const selected = type === selectedType ? 'selected' : '';
                    options += `<option value="${type}" ${selected}>${type}</option>`;
                });
                
                const required = (i === 0) ? 'required' : '';
                const label = (i === 0) ? `Tipo de Lavagem Principal:` : `Tipo de Lavagem Adicional ${i}:`;

                html += `
                    <div class="space-y-1 ${i > 0 ? 'mt-2' : ''}">
                        <label class="block text-xs font-medium text-gray-500">${label}</label>
                        <select 
                            id="editable-wash-type-select-${i}" 
                            data-type-index="${i}"
                            ${required}
                            class="wash-type-selector block w-full rounded-xl border border-gray-300 bg-white py-2 px-3 text-sm focus:ring-indigo-500 focus:border-indigo-500 transition duration-150"
                        >
                            ${options}
                        </select>
                    </div>
                `;
            }
            
            return `
                <div class="space-y-2 max-h-60 overflow-y-auto pr-2 border-l-2 pl-2 border-gray-200">
                    <p class="text-xs text-gray-500 font-semibold border-b pb-1">Escolha at√© 10 processos:</p>
                    ${html}
                </div>
            `;
        };


        const getStatusDropdown = (currentStatus) => {
            let options = '';
            for (const status in STATUS_MAP) {
                const selected = status === currentStatus ? 'selected' : '';
                options += `<option value="${status}" ${selected}>${STATUS_MAP[status].text}</option>`;
            }

            return `
                <select id="editable-status-select" class="block w-full rounded-xl border border-gray-300 bg-white py-2 px-3 text-sm focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
                    ${options}
                </select>
            `;
        };
        
        const attachUpdateListener = (sealId) => {
            const updateBtn = document.getElementById('update-all-btn');
            if (updateBtn) {
                updateBtn.addEventListener('click', () => {
                    simulateUpdate(sealId);
                });
            }
            const printBtn = document.getElementById('print-receipt-btn');
            if (printBtn) {
                printBtn.addEventListener('click', () => {
                    printReceipt(sealId);
                });
            }
        };

        const handleRegister = () => {
            const sealInput = document.getElementById('register-seal-input');
            const descInput = document.getElementById('register-desc-input');

            const newSealId = sealInput.value.trim();
            const newDescription = descInput.value.trim();

            if (!newSealId || !newDescription) {
                StatusMessage("Por favor, preencha o n√∫mero do lacre e a descri√ß√£o da pe√ßa.", 'error');
                return;
            }

            if (sealDataCache[newSealId]) {
                StatusMessage(`O Lacre ID ${newSealId} j√° est√° cadastrado. Tente outro n√∫mero.`, 'error');
                return;
            }
            
            sealDataCache[newSealId] = { 
                status: 'Pendente', 
                washType: [WASH_TYPES[0]], 
                description: newDescription 
            };
            
            sealInput.value = '';
            descInput.value = '';

            StatusMessage(`Lacre ID ${newSealId} cadastrado com sucesso! Use a aba "Buscar N√∫mero do Lacre" para encontr√°-lo.`, 'success');
        };
        
        const simulateUpdate = (sealId) => {
            const selectStatus = document.getElementById('editable-status-select');
            
            const washTypeSelectors = document.querySelectorAll('.wash-type-selector');
            const newWashTypes = [];
            
            washTypeSelectors.forEach((select) => {
                const value = select.value;
                if (value !== WASH_TYPES[0]) { 
                    newWashTypes.push(value);
                }
            });

            if (newWashTypes.length === 0) {
                 StatusMessage(`√â necess√°rio selecionar pelo menos um Tipo de Lavagem.`, 'error');
                 return;
            }

            const newStatus = selectStatus.value;
            const currentDescription = sealDataCache[sealId]?.description || '';
            
            sealDataCache[sealId] = sealDataCache[sealId] || {};
            sealDataCache[sealId].status = newStatus;
            sealDataCache[sealId].washType = newWashTypes; 
            sealDataCache[sealId].description = currentDescription; 
            
            StatusMessage(`Lacre ${sealId} atualizado! Status: ${STATUS_MAP[newStatus].text}, Tipos: ${newWashTypes.join(', ')}.`, 'success');
            
            document.getElementById('seal-details-area').innerHTML = getSealDetailsHTML(sealId, newStatus, newWashTypes);
            lucide.createIcons();
            
            attachUpdateListener(sealId);
        };
        
        const printReceipt = (sealId) => {
            window.print();
            StatusMessage(`Recibo para o Lacre ${sealId} enviado para impress√£o/PDF.`, 'info');
        };

        // getSealDetailsHTML: Estrutura adaptada com ID para o formul√°rio de atualiza√ß√£o
        const getSealDetailsHTML = (sealId, status, initialWashType) => {
            
            const currentWashTypes = sealDataCache[sealId]?.washType || (Array.isArray(initialWashType) ? initialWashType : [initialWashType]);
            const currentStatus = sealDataCache[sealId]?.status || status;
            const currentDescription = sealDataCache[sealId]?.description;

            let description = currentDescription || 'Pe√ßa de roupa padr√£o, n√£o especificada.';
            let observations = 'Recebido na lavanderia.';
            let deliveryDate = 'Previs√£o: 20/10/2025';
            
            if (!currentDescription) {
                switch (sealId) { 
                    case '11111':
                        description = 'Camisa social branca, com bot√£o solto.';
                        observations += ' Aguardando in√≠cio da lavagem.';
                        break;
                    case '22222': 
                        description = 'Cal√ßa jeans escura, com mancha na barra.';
                        observations += ' Em ciclo de lavagem especial.';
                        deliveryDate = 'Previs√£o: 18/10/2025';
                        break;
                    case '33333': 
                        description = 'Vestido de festa vermelho, delicado.';
                        observations = 'Limpeza finalizada e embalada. Aguardando retirada.';
                        deliveryDate = '16/10/2025';
                        break;
                    case '44444': 
                        description = 'Terno cinza, completo.';
                        observations = 'Retirado pelo cliente (Jo√£o Silva) em 14/10/2025.';
                        deliveryDate = '14/10/2025';
                        break;
                }
            }
            
            const washTypesDisplay = currentWashTypes.map(type => 
                `<span class="inline-block bg-indigo-100 text-indigo-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded">${type}</span>`
            ).join('');
            
            // Estrutura do Recibo/Detalhes
            return `
                <div class="bg-white p-6 rounded-xl shadow-lg border border-indigo-100 mt-6 space-y-4 receipt-content">
                    
                    <div class="receipt-header" style="display:none;">
                        <h1>LaveSmart Lavanderia</h1>
                        <p class="text-xs text-gray-500">Recibo de Entrada - Lacre #${sealId}</p>
                    </div>

                    <div class="border-b pb-2 mb-4">
                        <h3 class="text-xl font-bold text-indigo-700">Detalhes do Lacre: ${sealId}</h3>
                    </div>
                    
                    <div id="update-form-area" class="p-4 bg-indigo-50 rounded-lg space-y-4">
                        <h4 class="text-lg font-semibold text-indigo-800">Atualizar Informa√ß√µes da Pe√ßa</h4>
                        
                        <div class="space-y-1">
                            <label class="block text-sm font-medium text-gray-700">Status Atual da Lavagem:</label>
                            ${getStatusDropdown(currentStatus)}
                        </div>

                        <div class="space-y-1">
                            <label class="block text-sm font-medium text-gray-700">Tipos de Lavagem (M√°x. 10):</label>
                            ${getWashTypeSelectors(currentWashTypes)}
                        </div>
                        
                        <button
                            id="update-all-btn"
                            data-seal-id="${sealId}"
                            class="w-full flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-xl shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150 ease-in-out"
                        >
                            <i data-lucide="save" class="w-4 h-4 mr-2"></i> Salvar Altera√ß√µes
                        </button>
                        
                        <button
                            id="print-receipt-btn"
                            data-seal-id="${sealId}"
                            class="w-full flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-xl shadow-sm text-white bg-indigo-500 hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out mt-2"
                        >
                            <i data-lucide="printer" class="w-4 h-4 mr-2"></i> Imprimir Recibo (Salvar PDF)
                        </button>

                    </div>
                    <hr class="border-gray-100"/>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="md:col-span-1">
                            <div class="flex items-center justify-center w-full h-36 rounded-lg shadow-md ${STATUS_MAP[currentStatus].class}">
                                <span class="text-xl font-bold">${currentStatus}</span>
                            </div>
                            <p class="text-sm font-semibold mt-2 text-center text-gray-700">${description}</p>
                        </div>
                        <div class="md:col-span-2 space-y-2 text-sm">
                            <p><span class="font-medium text-gray-600">Descri√ß√£o da Pe√ßa:</span> ${description}</p>
                            <p class="font-medium text-gray-600">Tipos de Lavagem:</p>
                            <div class="flex flex-wrap">${washTypesDisplay}</div>
                            <p class="text-indigo-600"><span class='font-medium'>Data de Registro:</span> 15/10/2025 √†s 10:00:00</p>
                            <p class="text-gray-600"><span class='font-medium'>Data/Previs√£o de Entrega:</span> ${deliveryDate}</p>
                            <p class="break-words"><span class="font-medium text-gray-600">Observa√ß√µes:</span> ${observations}</p>
                            <p class="text-xs text-gray-400 mt-4 pt-2 border-t border-dashed">
                                Para rastrear: Use o Lacre ID ${sealId}.
                            </p>
                        </div>
                    </div>
                </div>
            `;
        };
        
        const handleSearch = () => {
            const sealInput = document.getElementById('seal-input');
            const detailsArea = document.getElementById('seal-details-area');
            const sealId = sealInput.value.trim();

            if (!sealId || sealId.length < 5) {
                StatusMessage("Por favor, digite um n√∫mero de lacre v√°lido (ex: 11111) para buscar.", 'error');
                detailsArea.innerHTML = '';
                return;
            }

            let status = null;
            let initialWashType = [WASH_TYPES[0]]; 
            
            if (sealDataCache[sealId]) {
                 status = sealDataCache[sealId].status;
                 initialWashType = sealDataCache[sealId].washType;
            } else {
                switch (sealId) {
                    case '11111': 
                        status = 'Pendente';
                        initialWashType = ['STONAGEM', 'AMACIADO']; 
                        break;
                    case '22222': 
                        status = 'Lavando';
                        initialWashType = ['BIGODE CURTO']; 
                        break;
                    case '33333': 
                        status = 'Pronto';
                        initialWashType = ['LASER', 'ALVEJAMENTO BRANCO', 'RESINA']; 
                        break;
                    case '44444': 
                        status = 'Entregue';
                        initialWashType = ['TINGIMENTO']; 
                        break;
                    default:
                        if (sealId.length === 5) {
                            StatusMessage(`Lacre ID ${sealId} n√£o encontrado. Verifique o n√∫mero digitado ou cadastre-o.`, 'error');
                            detailsArea.innerHTML = '';
                            return;
                        }
                }

                if (status) {
                    sealDataCache[sealId] = { 
                        status: status, 
                        washType: initialWashType,
                        description: null 
                    };
                }
            }


            if (status) {
                
                const currentStatus = sealDataCache[sealId].status;
                const currentWashType = sealDataCache[sealId].washType;

                detailsArea.innerHTML = getSealDetailsHTML(sealId, currentStatus, currentWashType); 
                StatusMessage(`Lacre ID ${sealId} encontrado! Status: ${STATUS_MAP[currentStatus].text}.`, 'success');

                attachUpdateListener(sealId); 
                
            } else {
                detailsArea.innerHTML = `
                    <div class="text-center py-6 text-gray-500 font-medium">
                        <i data-lucide="alert-triangle" class="w-5 h-5 mr-1 inline-block text-red-500"></i>
                        Lacre ${sealId} n√£o encontrado. Verifique o n√∫mero digitado.
                    </div>
                `;
                StatusMessage(`Lacre ID ${sealId} n√£o encontrado.`, 'error');
            }
            lucide.createIcons();
        };

        // =================================================================
        // INICIALIZA√á√ÉO E LISTENERS
        // =================================================================

        window.onload = function() {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            const historyTab = document.getElementById('tab-history');
            const registerTab = document.getElementById('tab-register');
            const historyContent = document.getElementById('content-history');
            const registerContent = document.getElementById('content-register');

            if (historyTab && registerTab) {
                historyTab.onclick = () => {
                    historyTab.classList.add('active');
                    registerTab.classList.remove('active');
                    historyContent.setAttribute('aria-hidden', 'false');
                    registerContent.setAttribute('aria-hidden', 'true');
                    historyContent.style.display = 'block';
                    registerContent.style.display = 'none';
                    lucide.createIcons();
                };
                
                registerTab.onclick = () => {
                    registerTab.classList.add('active');
                    historyTab.classList.remove('active');
                    registerContent.setAttribute('aria-hidden', 'false');
                    historyContent.setAttribute('aria-hidden', 'true');
                    registerContent.style.display = 'block';
                    historyContent.style.display = 'none';
                    lucide.createIcons();
                };
            }
            
            const searchBtn = document.getElementById('search-seal-btn');
            const sealInput = document.getElementById('seal-input');
            
            if (searchBtn && sealInput) {
                searchBtn.addEventListener('click', handleSearch);
                sealInput.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        e.preventDefault(); 
                        handleSearch();
                    }
                });
            }
            
            const registerForm = document.getElementById('register-seal-form');
            if (registerForm) {
                registerForm.addEventListener('submit', function (e) {
                    e.preventDefault(); 
                    handleRegister();
                });
            }
        };
    </script>
</body>
</html>